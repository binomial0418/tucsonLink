version: '3.8'

services:
  # 1. 網頁伺服器 (PHP + Apache)
  web:
    image: php:7.3-apache  # 您可以改成 php:7.4-apache 如果您的 code 比較舊
    container_name: tucson_web
    ports:
      - "8081:80"          # 瀏覽器打 localhost:8080 就會連到這裡
    volumes:
      - ./:/var/www/html/  # 把目前的資料夾掛載進去，改 code 即時生效
    depends_on:
      - db
    environment:
      - TZ=Asia/Taipei
    # 如果需要 mysqli 擴充 (連接資料庫用)，需要這行指令
    command: >
      bash -c "docker-php-ext-install mysqli pdo pdo_mysql && docker-php-ext-enable pdo_mysql && apache2-foreground"

  # 2. 資料庫 (MySQL / MariaDB)
  db:
    image: mariadb:10.6
    container_name: tucson_db
    environment:
      MYSQL_ROOT_PASSWORD: root  # 測試用密碼，自己記住就好
      MYSQL_DATABASE: tucson_db  # 預設建立的資料庫名稱
      TZ: Asia/Taipei
    ports:
      - "3306:3306"        # 讓您的電腦可以用管理工具連進去
    volumes:
      - db_data:/var/lib/mysql # 確保關掉容器後資料還在

volumes:
  db_data: